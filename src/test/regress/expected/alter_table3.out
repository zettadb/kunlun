drop table if exists t1;
psql:sql/alter_table3.sql:1: NOTICE:  table "t1" does not exist, skipping
DROP TABLE
drop table if exists t100;
DROP TABLE
drop table if exists t101;
DROP TABLE
drop table if exists t102;
DROP TABLE
drop table if exists t103;
DROP TABLE
drop table if exists t30;
psql:sql/alter_table3.sql:6: NOTICE:  table "t30" does not exist, skipping
DROP TABLE
drop table if exists t301;
psql:sql/alter_table3.sql:7: NOTICE:  table "t301" does not exist, skipping
DROP TABLE
drop table if exists t302;
psql:sql/alter_table3.sql:8: NOTICE:  table "t302" does not exist, skipping
DROP TABLE
drop table if exists t303;
psql:sql/alter_table3.sql:9: NOTICE:  table "t303" does not exist, skipping
DROP TABLE
drop table if exists t304;
psql:sql/alter_table3.sql:10: NOTICE:  table "t304" does not exist, skipping
DROP TABLE
create table t1(a serial primary key, b int) partition by hash(a);
CREATE TABLE
create table t100 partition of t1 for values with (modulus 4, remainder 0);
CREATE TABLE
create table t101 partition of t1 for values with (modulus 4, remainder 1);
CREATE TABLE
create table t102 partition of t1 for values with (modulus 4, remainder 2);
CREATE TABLE
create table t103 partition of t1 for values with (modulus 4, remainder 3);
CREATE TABLE
insert into t1(b) values(11),(22),(33);
INSERT 0 3
--alter table t1 add column c int not null;
--\d+ t1;
--select*from t1;
--alter table t1 drop column c;
select*from t1;
 a | b  
---+----
 1 | 11
 3 | 33
 2 | 22
(3 rows)

insert into t1(b) values(11),(22),(33), (11),(22),(33), (11),(22),(33), (11),(22),(33);
INSERT 0 12
alter table t1 add column c int;
ALTER TABLE
--\d+ t1;
select*from t1;
 a  | b  | c 
----+----+---
  1 | 11 |  
 12 | 33 |  
 14 | 22 |  
  3 | 33 |  
  5 | 22 |  
  8 | 22 |  
  9 | 33 |  
 11 | 22 |  
  2 | 22 |  
 13 | 11 |  
  4 | 11 |  
  6 | 33 |  
  7 | 11 |  
 10 | 11 |  
 15 | 33 |  
(15 rows)

alter table t1 alter column c set default 123;
ALTER TABLE
--\d+ t1;
insert into t1(b) values(44);
INSERT 0 1
insert into t1(b,c) values(44, 45);
INSERT 0 1
select*from t1;
 a  | b  |  c  
----+----+-----
  1 | 11 |    
 12 | 33 |    
 14 | 22 |    
 16 | 44 | 123
 17 | 44 |  45
  3 | 33 |    
  5 | 22 |    
  8 | 22 |    
  9 | 33 |    
 11 | 22 |    
  2 | 22 |    
 13 | 11 |    
  4 | 11 |    
  6 | 33 |    
  7 | 11 |    
 10 | 11 |    
 15 | 33 |    
(17 rows)

alter table t1 alter column c drop default;
ALTER TABLE
--\d+ t1;
insert into t1(b) values(55);
INSERT 0 1
select*from t1;
 a  | b  |  c  
----+----+-----
  1 | 11 |    
 12 | 33 |    
 14 | 22 |    
 16 | 44 | 123
 17 | 44 |  45
  3 | 33 |    
  5 | 22 |    
  8 | 22 |    
  9 | 33 |    
 11 | 22 |    
  2 | 22 |    
 13 | 11 |    
 18 | 55 |    
  4 | 11 |    
  6 | 33 |    
  7 | 11 |    
 10 | 11 |    
 15 | 33 |    
(18 rows)

alter table t1 drop column c;
ALTER TABLE
alter table t1 add column c int default 123456789;
ALTER TABLE
--\d+ t1;
select*from t1;
 a  | b  |     c     
----+----+-----------
  1 | 11 | 123456789
 12 | 33 | 123456789
 14 | 22 | 123456789
 16 | 44 | 123456789
 17 | 44 | 123456789
  3 | 33 | 123456789
  5 | 22 | 123456789
  8 | 22 | 123456789
  9 | 33 | 123456789
 11 | 22 | 123456789
  2 | 22 | 123456789
 13 | 11 | 123456789
 18 | 55 | 123456789
  4 | 11 | 123456789
  6 | 33 | 123456789
  7 | 11 | 123456789
 10 | 11 | 123456789
 15 | 33 | 123456789
(18 rows)

alter table t1 alter column c smallint not null;
psql:sql/alter_table3.sql:43: ERROR:  syntax error at or near "smallint"
LINE 1: alter table t1 alter column c smallint not null;
                                      ^
--alter table t1 alter column c type smallint;
--\d+ t1;
alter table t1 alter column c type int not null;
psql:sql/alter_table3.sql:47: ERROR:  syntax error at or near "not"
LINE 1: alter table t1 alter column c type int not null;
                                               ^
alter table t1 alter column c set not null;
ALTER TABLE
--\d+ t1;
insert into t1(b) values(66);
INSERT 0 1
select*from t1;
 a  | b  |     c     
----+----+-----------
  1 | 11 | 123456789
 12 | 33 | 123456789
 14 | 22 | 123456789
 16 | 44 | 123456789
 17 | 44 | 123456789
  3 | 33 | 123456789
  5 | 22 | 123456789
  8 | 22 | 123456789
  9 | 33 | 123456789
 11 | 22 | 123456789
 19 | 66 | 123456789
  2 | 22 | 123456789
 13 | 11 | 123456789
 18 | 55 | 123456789
  4 | 11 | 123456789
  6 | 33 | 123456789
  7 | 11 | 123456789
 10 | 11 | 123456789
 15 | 33 | 123456789
(19 rows)

--\d+ t1;
alter table t1 alter column c drop not null;
ALTER TABLE
--\d+ t1;
insert into t1(b) values(66);
INSERT 0 1
select*from t1;
 a  | b  |     c     
----+----+-----------
  1 | 11 | 123456789
 12 | 33 | 123456789
 14 | 22 | 123456789
 16 | 44 | 123456789
 17 | 44 | 123456789
  3 | 33 | 123456789
  5 | 22 | 123456789
  8 | 22 | 123456789
  9 | 33 | 123456789
 11 | 22 | 123456789
 19 | 66 | 123456789
 20 | 66 | 123456789
  2 | 22 | 123456789
 13 | 11 | 123456789
 18 | 55 | 123456789
  4 | 11 | 123456789
  6 | 33 | 123456789
  7 | 11 | 123456789
 10 | 11 | 123456789
 15 | 33 | 123456789
(20 rows)

alter table t1 alter column c set not null;
ALTER TABLE
--\d+ t1;
insert into t1(b) values(66);
INSERT 0 1
select*from t1;
 a  | b  |     c     
----+----+-----------
  1 | 11 | 123456789
 12 | 33 | 123456789
 14 | 22 | 123456789
 16 | 44 | 123456789
 17 | 44 | 123456789
  3 | 33 | 123456789
  5 | 22 | 123456789
  8 | 22 | 123456789
  9 | 33 | 123456789
 11 | 22 | 123456789
 19 | 66 | 123456789
 20 | 66 | 123456789
 21 | 66 | 123456789
  2 | 22 | 123456789
 13 | 11 | 123456789
 18 | 55 | 123456789
  4 | 11 | 123456789
  6 | 33 | 123456789
  7 | 11 | 123456789
 10 | 11 | 123456789
 15 | 33 | 123456789
(21 rows)

--alter table t1 add column d varchar(32) not null;
alter table t1 add column d varchar(32);
ALTER TABLE
--\d+ t1;
select*, d is null as disnull, length(d) from t1;
 a  | b  |     c     | d | disnull | length 
----+----+-----------+---+---------+--------
  1 | 11 | 123456789 |   | t       |       
 12 | 33 | 123456789 |   | t       |       
 14 | 22 | 123456789 |   | t       |       
 16 | 44 | 123456789 |   | t       |       
 17 | 44 | 123456789 |   | t       |       
  3 | 33 | 123456789 |   | t       |       
  5 | 22 | 123456789 |   | t       |       
  8 | 22 | 123456789 |   | t       |       
  9 | 33 | 123456789 |   | t       |       
 11 | 22 | 123456789 |   | t       |       
 19 | 66 | 123456789 |   | t       |       
 20 | 66 | 123456789 |   | t       |       
 21 | 66 | 123456789 |   | t       |       
  2 | 22 | 123456789 |   | t       |       
 13 | 11 | 123456789 |   | t       |       
 18 | 55 | 123456789 |   | t       |       
  4 | 11 | 123456789 |   | t       |       
  6 | 33 | 123456789 |   | t       |       
  7 | 11 | 123456789 |   | t       |       
 10 | 11 | 123456789 |   | t       |       
 15 | 33 | 123456789 |   | t       |       
(21 rows)

alter table t1 alter column d set default 'ddd';
ALTER TABLE
--\d+ t1;
insert into t1(b) values(77);
INSERT 0 1
select*from t1;
 a  | b  |     c     |  d  
----+----+-----------+-----
  1 | 11 | 123456789 | 
 12 | 33 | 123456789 | 
 14 | 22 | 123456789 | 
 16 | 44 | 123456789 | 
 17 | 44 | 123456789 | 
  3 | 33 | 123456789 | 
  5 | 22 | 123456789 | 
  8 | 22 | 123456789 | 
  9 | 33 | 123456789 | 
 11 | 22 | 123456789 | 
 19 | 66 | 123456789 | 
 20 | 66 | 123456789 | 
 21 | 66 | 123456789 | 
  2 | 22 | 123456789 | 
 13 | 11 | 123456789 | 
 18 | 55 | 123456789 | 
  4 | 11 | 123456789 | 
  6 | 33 | 123456789 | 
  7 | 11 | 123456789 | 
 10 | 11 | 123456789 | 
 15 | 33 | 123456789 | 
 22 | 77 | 123456789 | ddd
(22 rows)

alter table t1 alter column d drop default;
ALTER TABLE
--\d+ t1;
insert into t1(b) values(77);
INSERT 0 1
select*from t1;
 a  | b  |     c     |  d  
----+----+-----------+-----
  1 | 11 | 123456789 | 
 12 | 33 | 123456789 | 
 14 | 22 | 123456789 | 
 16 | 44 | 123456789 | 
 17 | 44 | 123456789 | 
  3 | 33 | 123456789 | 
  5 | 22 | 123456789 | 
  8 | 22 | 123456789 | 
  9 | 33 | 123456789 | 
 11 | 22 | 123456789 | 
 19 | 66 | 123456789 | 
 20 | 66 | 123456789 | 
 21 | 66 | 123456789 | 
  2 | 22 | 123456789 | 
 13 | 11 | 123456789 | 
 18 | 55 | 123456789 | 
 23 | 77 | 123456789 | 
  4 | 11 | 123456789 | 
  6 | 33 | 123456789 | 
  7 | 11 | 123456789 | 
 10 | 11 | 123456789 | 
 15 | 33 | 123456789 | 
 22 | 77 | 123456789 | ddd
(23 rows)

alter table t1 alter column d ;
psql:sql/alter_table3.sql:76: ERROR:  syntax error at or near ";"
LINE 1: alter table t1 alter column d ;
                                      ^
--\d+ t1;
insert into t1(b) values(77);
INSERT 0 1
--select*from t1;
--alter table t1 alter column d drop not null;
--\d+ t1;
insert into t1(b) values(77);
INSERT 0 1
select*from t1;
 a  | b  |     c     |  d  
----+----+-----------+-----
  1 | 11 | 123456789 | 
 12 | 33 | 123456789 | 
 14 | 22 | 123456789 | 
 16 | 44 | 123456789 | 
 17 | 44 | 123456789 | 
  3 | 33 | 123456789 | 
  5 | 22 | 123456789 | 
  8 | 22 | 123456789 | 
  9 | 33 | 123456789 | 
 11 | 22 | 123456789 | 
 19 | 66 | 123456789 | 
 20 | 66 | 123456789 | 
 21 | 66 | 123456789 | 
  2 | 22 | 123456789 | 
 13 | 11 | 123456789 | 
 18 | 55 | 123456789 | 
 23 | 77 | 123456789 | 
 25 | 77 | 123456789 | 
  4 | 11 | 123456789 | 
  6 | 33 | 123456789 | 
  7 | 11 | 123456789 | 
 10 | 11 | 123456789 | 
 15 | 33 | 123456789 | 
 22 | 77 | 123456789 | ddd
 24 | 77 | 123456789 | 
(25 rows)

alter table t1 drop column d;
ALTER TABLE
alter table t1 add column d varchar(32) default 'dddddddd';
ALTER TABLE
select*from t1;
 a  | b  |     c     |    d     
----+----+-----------+----------
  1 | 11 | 123456789 | dddddddd
 12 | 33 | 123456789 | dddddddd
 14 | 22 | 123456789 | dddddddd
 16 | 44 | 123456789 | dddddddd
 17 | 44 | 123456789 | dddddddd
  3 | 33 | 123456789 | dddddddd
  5 | 22 | 123456789 | dddddddd
  8 | 22 | 123456789 | dddddddd
  9 | 33 | 123456789 | dddddddd
 11 | 22 | 123456789 | dddddddd
 19 | 66 | 123456789 | dddddddd
 20 | 66 | 123456789 | dddddddd
 21 | 66 | 123456789 | dddddddd
  2 | 22 | 123456789 | dddddddd
 13 | 11 | 123456789 | dddddddd
 18 | 55 | 123456789 | dddddddd
 23 | 77 | 123456789 | dddddddd
 25 | 77 | 123456789 | dddddddd
  4 | 11 | 123456789 | dddddddd
  6 | 33 | 123456789 | dddddddd
  7 | 11 | 123456789 | dddddddd
 10 | 11 | 123456789 | dddddddd
 15 | 33 | 123456789 | dddddddd
 22 | 77 | 123456789 | dddddddd
 24 | 77 | 123456789 | dddddddd
(25 rows)

alter table t1 alter column d type varchar(2) default 'd';
psql:sql/alter_table3.sql:88: ERROR:  syntax error at or near "default"
LINE 1: alter table t1 alter column d type varchar(2) default 'd';
                                                      ^
--alter table t1 alter column d type varchar(2);
alter table t1 alter column d type char(2) default 'd';
psql:sql/alter_table3.sql:90: ERROR:  syntax error at or near "default"
LINE 1: alter table t1 alter column d type char(2) default 'd';
                                                   ^
--alter table t1 alter column d type char(2);
alter table t1 alter column d type char(32);
ALTER TABLE
--\d+ t1;
insert into t1 (b) values(88);
INSERT 0 1
select*from t1 order by 1,2;
 a  | b  |     c     |                d                 
----+----+-----------+----------------------------------
  1 | 11 | 123456789 | dddddddd                        
  2 | 22 | 123456789 | dddddddd                        
  3 | 33 | 123456789 | dddddddd                        
  4 | 11 | 123456789 | dddddddd                        
  5 | 22 | 123456789 | dddddddd                        
  6 | 33 | 123456789 | dddddddd                        
  7 | 11 | 123456789 | dddddddd                        
  8 | 22 | 123456789 | dddddddd                        
  9 | 33 | 123456789 | dddddddd                        
 10 | 11 | 123456789 | dddddddd                        
 11 | 22 | 123456789 | dddddddd                        
 12 | 33 | 123456789 | dddddddd                        
 13 | 11 | 123456789 | dddddddd                        
 14 | 22 | 123456789 | dddddddd                        
 15 | 33 | 123456789 | dddddddd                        
 16 | 44 | 123456789 | dddddddd                        
 17 | 44 | 123456789 | dddddddd                        
 18 | 55 | 123456789 | dddddddd                        
 19 | 66 | 123456789 | dddddddd                        
 20 | 66 | 123456789 | dddddddd                        
 21 | 66 | 123456789 | dddddddd                        
 22 | 77 | 123456789 | dddddddd                        
 23 | 77 | 123456789 | dddddddd                        
 24 | 77 | 123456789 | dddddddd                        
 25 | 77 | 123456789 | dddddddd                        
 26 | 88 | 123456789 | dddddddd                        
(26 rows)

alter table t1 add column e varchar(32) not null default 'abc';
ALTER TABLE
select*from t1 order by 1,2;
 a  | b  |     c     |                d                 |  e  
----+----+-----------+----------------------------------+-----
  1 | 11 | 123456789 | dddddddd                         | abc
  2 | 22 | 123456789 | dddddddd                         | abc
  3 | 33 | 123456789 | dddddddd                         | abc
  4 | 11 | 123456789 | dddddddd                         | abc
  5 | 22 | 123456789 | dddddddd                         | abc
  6 | 33 | 123456789 | dddddddd                         | abc
  7 | 11 | 123456789 | dddddddd                         | abc
  8 | 22 | 123456789 | dddddddd                         | abc
  9 | 33 | 123456789 | dddddddd                         | abc
 10 | 11 | 123456789 | dddddddd                         | abc
 11 | 22 | 123456789 | dddddddd                         | abc
 12 | 33 | 123456789 | dddddddd                         | abc
 13 | 11 | 123456789 | dddddddd                         | abc
 14 | 22 | 123456789 | dddddddd                         | abc
 15 | 33 | 123456789 | dddddddd                         | abc
 16 | 44 | 123456789 | dddddddd                         | abc
 17 | 44 | 123456789 | dddddddd                         | abc
 18 | 55 | 123456789 | dddddddd                         | abc
 19 | 66 | 123456789 | dddddddd                         | abc
 20 | 66 | 123456789 | dddddddd                         | abc
 21 | 66 | 123456789 | dddddddd                         | abc
 22 | 77 | 123456789 | dddddddd                         | abc
 23 | 77 | 123456789 | dddddddd                         | abc
 24 | 77 | 123456789 | dddddddd                         | abc
 25 | 77 | 123456789 | dddddddd                         | abc
 26 | 88 | 123456789 | dddddddd                         | abc
(26 rows)

alter table t1 rename c to cc, drop column c;
psql:sql/alter_table3.sql:99: ERROR:  syntax error at or near ","
LINE 1: alter table t1 rename c to cc, drop column c;
                                     ^
alter table t1 rename c to cc, rename b to bb;
psql:sql/alter_table3.sql:100: ERROR:  syntax error at or near ","
LINE 1: alter table t1 rename c to cc, rename b to bb;
                                     ^
alter table t1 rename a to aa;
ALTER TABLE
--\d+ t1;
insert into t1 (b) values(99);
INSERT 0 1
select*from t1 order by 1,2;
 aa | b  |     c     |                d                 |  e  
----+----+-----------+----------------------------------+-----
  1 | 11 | 123456789 | dddddddd                         | abc
  2 | 22 | 123456789 | dddddddd                         | abc
  3 | 33 | 123456789 | dddddddd                         | abc
  4 | 11 | 123456789 | dddddddd                         | abc
  5 | 22 | 123456789 | dddddddd                         | abc
  6 | 33 | 123456789 | dddddddd                         | abc
  7 | 11 | 123456789 | dddddddd                         | abc
  8 | 22 | 123456789 | dddddddd                         | abc
  9 | 33 | 123456789 | dddddddd                         | abc
 10 | 11 | 123456789 | dddddddd                         | abc
 11 | 22 | 123456789 | dddddddd                         | abc
 12 | 33 | 123456789 | dddddddd                         | abc
 13 | 11 | 123456789 | dddddddd                         | abc
 14 | 22 | 123456789 | dddddddd                         | abc
 15 | 33 | 123456789 | dddddddd                         | abc
 16 | 44 | 123456789 | dddddddd                         | abc
 17 | 44 | 123456789 | dddddddd                         | abc
 18 | 55 | 123456789 | dddddddd                         | abc
 19 | 66 | 123456789 | dddddddd                         | abc
 20 | 66 | 123456789 | dddddddd                         | abc
 21 | 66 | 123456789 | dddddddd                         | abc
 22 | 77 | 123456789 | dddddddd                         | abc
 23 | 77 | 123456789 | dddddddd                         | abc
 24 | 77 | 123456789 | dddddddd                         | abc
 25 | 77 | 123456789 | dddddddd                         | abc
 26 | 88 | 123456789 | dddddddd                         | abc
 27 | 99 | 123456789 | dddddddd                         | abc
(27 rows)

alter table t1 drop column c, add column f int not null default 123, add column g int not null default 123, alter column b type bigint;
ALTER TABLE
--\d+ t1;
select*from t1 order by 1,2;
 aa | b  |                d                 |  e  |  f  |  g  
----+----+----------------------------------+-----+-----+-----
  1 | 11 | dddddddd                         | abc | 123 | 123
  2 | 22 | dddddddd                         | abc | 123 | 123
  3 | 33 | dddddddd                         | abc | 123 | 123
  4 | 11 | dddddddd                         | abc | 123 | 123
  5 | 22 | dddddddd                         | abc | 123 | 123
  6 | 33 | dddddddd                         | abc | 123 | 123
  7 | 11 | dddddddd                         | abc | 123 | 123
  8 | 22 | dddddddd                         | abc | 123 | 123
  9 | 33 | dddddddd                         | abc | 123 | 123
 10 | 11 | dddddddd                         | abc | 123 | 123
 11 | 22 | dddddddd                         | abc | 123 | 123
 12 | 33 | dddddddd                         | abc | 123 | 123
 13 | 11 | dddddddd                         | abc | 123 | 123
 14 | 22 | dddddddd                         | abc | 123 | 123
 15 | 33 | dddddddd                         | abc | 123 | 123
 16 | 44 | dddddddd                         | abc | 123 | 123
 17 | 44 | dddddddd                         | abc | 123 | 123
 18 | 55 | dddddddd                         | abc | 123 | 123
 19 | 66 | dddddddd                         | abc | 123 | 123
 20 | 66 | dddddddd                         | abc | 123 | 123
 21 | 66 | dddddddd                         | abc | 123 | 123
 22 | 77 | dddddddd                         | abc | 123 | 123
 23 | 77 | dddddddd                         | abc | 123 | 123
 24 | 77 | dddddddd                         | abc | 123 | 123
 25 | 77 | dddddddd                         | abc | 123 | 123
 26 | 88 | dddddddd                         | abc | 123 | 123
 27 | 99 | dddddddd                         | abc | 123 | 123
(27 rows)

insert into t1(f) values(333);
INSERT 0 1
insert into t1(b) values(222);
INSERT 0 1
select*from t1 order by 1,2;
 aa |  b  |                d                 |  e  |  f  |  g  
----+-----+----------------------------------+-----+-----+-----
  1 |  11 | dddddddd                         | abc | 123 | 123
  2 |  22 | dddddddd                         | abc | 123 | 123
  3 |  33 | dddddddd                         | abc | 123 | 123
  4 |  11 | dddddddd                         | abc | 123 | 123
  5 |  22 | dddddddd                         | abc | 123 | 123
  6 |  33 | dddddddd                         | abc | 123 | 123
  7 |  11 | dddddddd                         | abc | 123 | 123
  8 |  22 | dddddddd                         | abc | 123 | 123
  9 |  33 | dddddddd                         | abc | 123 | 123
 10 |  11 | dddddddd                         | abc | 123 | 123
 11 |  22 | dddddddd                         | abc | 123 | 123
 12 |  33 | dddddddd                         | abc | 123 | 123
 13 |  11 | dddddddd                         | abc | 123 | 123
 14 |  22 | dddddddd                         | abc | 123 | 123
 15 |  33 | dddddddd                         | abc | 123 | 123
 16 |  44 | dddddddd                         | abc | 123 | 123
 17 |  44 | dddddddd                         | abc | 123 | 123
 18 |  55 | dddddddd                         | abc | 123 | 123
 19 |  66 | dddddddd                         | abc | 123 | 123
 20 |  66 | dddddddd                         | abc | 123 | 123
 21 |  66 | dddddddd                         | abc | 123 | 123
 22 |  77 | dddddddd                         | abc | 123 | 123
 23 |  77 | dddddddd                         | abc | 123 | 123
 24 |  77 | dddddddd                         | abc | 123 | 123
 25 |  77 | dddddddd                         | abc | 123 | 123
 26 |  88 | dddddddd                         | abc | 123 | 123
 27 |  99 | dddddddd                         | abc | 123 | 123
 28 |     | dddddddd                         | abc | 333 | 123
 29 | 222 | dddddddd                         | abc | 123 | 123
(29 rows)

alter table t1 rename f to ff;
ALTER TABLE
alter table t1 rename d to dd;
ALTER TABLE
--\d+ t1;
select*from t1 order by 1,2;
 aa |  b  |                dd                |  e  | ff  |  g  
----+-----+----------------------------------+-----+-----+-----
  1 |  11 | dddddddd                         | abc | 123 | 123
  2 |  22 | dddddddd                         | abc | 123 | 123
  3 |  33 | dddddddd                         | abc | 123 | 123
  4 |  11 | dddddddd                         | abc | 123 | 123
  5 |  22 | dddddddd                         | abc | 123 | 123
  6 |  33 | dddddddd                         | abc | 123 | 123
  7 |  11 | dddddddd                         | abc | 123 | 123
  8 |  22 | dddddddd                         | abc | 123 | 123
  9 |  33 | dddddddd                         | abc | 123 | 123
 10 |  11 | dddddddd                         | abc | 123 | 123
 11 |  22 | dddddddd                         | abc | 123 | 123
 12 |  33 | dddddddd                         | abc | 123 | 123
 13 |  11 | dddddddd                         | abc | 123 | 123
 14 |  22 | dddddddd                         | abc | 123 | 123
 15 |  33 | dddddddd                         | abc | 123 | 123
 16 |  44 | dddddddd                         | abc | 123 | 123
 17 |  44 | dddddddd                         | abc | 123 | 123
 18 |  55 | dddddddd                         | abc | 123 | 123
 19 |  66 | dddddddd                         | abc | 123 | 123
 20 |  66 | dddddddd                         | abc | 123 | 123
 21 |  66 | dddddddd                         | abc | 123 | 123
 22 |  77 | dddddddd                         | abc | 123 | 123
 23 |  77 | dddddddd                         | abc | 123 | 123
 24 |  77 | dddddddd                         | abc | 123 | 123
 25 |  77 | dddddddd                         | abc | 123 | 123
 26 |  88 | dddddddd                         | abc | 123 | 123
 27 |  99 | dddddddd                         | abc | 123 | 123
 28 |     | dddddddd                         | abc | 333 | 123
 29 | 222 | dddddddd                         | abc | 123 | 123
(29 rows)

alter table t1 rename to t11;
ALTER TABLE
--\d+ t1;
--\d+ t11;
alter table t11 rename b to bb;
ALTER TABLE
--\d+ t11;
select*from t11 order by 1,2;
 aa | bb  |                dd                |  e  | ff  |  g  
----+-----+----------------------------------+-----+-----+-----
  1 |  11 | dddddddd                         | abc | 123 | 123
  2 |  22 | dddddddd                         | abc | 123 | 123
  3 |  33 | dddddddd                         | abc | 123 | 123
  4 |  11 | dddddddd                         | abc | 123 | 123
  5 |  22 | dddddddd                         | abc | 123 | 123
  6 |  33 | dddddddd                         | abc | 123 | 123
  7 |  11 | dddddddd                         | abc | 123 | 123
  8 |  22 | dddddddd                         | abc | 123 | 123
  9 |  33 | dddddddd                         | abc | 123 | 123
 10 |  11 | dddddddd                         | abc | 123 | 123
 11 |  22 | dddddddd                         | abc | 123 | 123
 12 |  33 | dddddddd                         | abc | 123 | 123
 13 |  11 | dddddddd                         | abc | 123 | 123
 14 |  22 | dddddddd                         | abc | 123 | 123
 15 |  33 | dddddddd                         | abc | 123 | 123
 16 |  44 | dddddddd                         | abc | 123 | 123
 17 |  44 | dddddddd                         | abc | 123 | 123
 18 |  55 | dddddddd                         | abc | 123 | 123
 19 |  66 | dddddddd                         | abc | 123 | 123
 20 |  66 | dddddddd                         | abc | 123 | 123
 21 |  66 | dddddddd                         | abc | 123 | 123
 22 |  77 | dddddddd                         | abc | 123 | 123
 23 |  77 | dddddddd                         | abc | 123 | 123
 24 |  77 | dddddddd                         | abc | 123 | 123
 25 |  77 | dddddddd                         | abc | 123 | 123
 26 |  88 | dddddddd                         | abc | 123 | 123
 27 |  99 | dddddddd                         | abc | 123 | 123
 28 |     | dddddddd                         | abc | 333 | 123
 29 | 222 | dddddddd                         | abc | 123 | 123
(29 rows)

create index t11_b on t11(bb);
CREATE INDEX
--\d+ t11;
alter index t11_b rename to t11_bb;
ALTER INDEX
--\d+ t11;
select*from t11 order by 1,2;
 aa | bb  |                dd                |  e  | ff  |  g  
----+-----+----------------------------------+-----+-----+-----
  1 |  11 | dddddddd                         | abc | 123 | 123
  2 |  22 | dddddddd                         | abc | 123 | 123
  3 |  33 | dddddddd                         | abc | 123 | 123
  4 |  11 | dddddddd                         | abc | 123 | 123
  5 |  22 | dddddddd                         | abc | 123 | 123
  6 |  33 | dddddddd                         | abc | 123 | 123
  7 |  11 | dddddddd                         | abc | 123 | 123
  8 |  22 | dddddddd                         | abc | 123 | 123
  9 |  33 | dddddddd                         | abc | 123 | 123
 10 |  11 | dddddddd                         | abc | 123 | 123
 11 |  22 | dddddddd                         | abc | 123 | 123
 12 |  33 | dddddddd                         | abc | 123 | 123
 13 |  11 | dddddddd                         | abc | 123 | 123
 14 |  22 | dddddddd                         | abc | 123 | 123
 15 |  33 | dddddddd                         | abc | 123 | 123
 16 |  44 | dddddddd                         | abc | 123 | 123
 17 |  44 | dddddddd                         | abc | 123 | 123
 18 |  55 | dddddddd                         | abc | 123 | 123
 19 |  66 | dddddddd                         | abc | 123 | 123
 20 |  66 | dddddddd                         | abc | 123 | 123
 21 |  66 | dddddddd                         | abc | 123 | 123
 22 |  77 | dddddddd                         | abc | 123 | 123
 23 |  77 | dddddddd                         | abc | 123 | 123
 24 |  77 | dddddddd                         | abc | 123 | 123
 25 |  77 | dddddddd                         | abc | 123 | 123
 26 |  88 | dddddddd                         | abc | 123 | 123
 27 |  99 | dddddddd                         | abc | 123 | 123
 28 |     | dddddddd                         | abc | 333 | 123
 29 | 222 | dddddddd                         | abc | 123 | 123
(29 rows)

create schema scm3;
CREATE SCHEMA
alter table t11 set schema scm3;
ALTER TABLE
insert into scm3.t11(aa) values (999);
INSERT 0 1
insert into scm3.t11(bb) values(333),(334),(335),(336),(337),(338),(339),(340),(341),(342),(343),(344),(345);
INSERT 0 13
select*from scm3.t11 order by aa;
 aa  | bb  |                dd                |  e  | ff  |  g  
-----+-----+----------------------------------+-----+-----+-----
   1 |  11 | dddddddd                         | abc | 123 | 123
   2 |  22 | dddddddd                         | abc | 123 | 123
   3 |  33 | dddddddd                         | abc | 123 | 123
   4 |  11 | dddddddd                         | abc | 123 | 123
   5 |  22 | dddddddd                         | abc | 123 | 123
   6 |  33 | dddddddd                         | abc | 123 | 123
   7 |  11 | dddddddd                         | abc | 123 | 123
   8 |  22 | dddddddd                         | abc | 123 | 123
   9 |  33 | dddddddd                         | abc | 123 | 123
  10 |  11 | dddddddd                         | abc | 123 | 123
  11 |  22 | dddddddd                         | abc | 123 | 123
  12 |  33 | dddddddd                         | abc | 123 | 123
  13 |  11 | dddddddd                         | abc | 123 | 123
  14 |  22 | dddddddd                         | abc | 123 | 123
  15 |  33 | dddddddd                         | abc | 123 | 123
  16 |  44 | dddddddd                         | abc | 123 | 123
  17 |  44 | dddddddd                         | abc | 123 | 123
  18 |  55 | dddddddd                         | abc | 123 | 123
  19 |  66 | dddddddd                         | abc | 123 | 123
  20 |  66 | dddddddd                         | abc | 123 | 123
  21 |  66 | dddddddd                         | abc | 123 | 123
  22 |  77 | dddddddd                         | abc | 123 | 123
  23 |  77 | dddddddd                         | abc | 123 | 123
  24 |  77 | dddddddd                         | abc | 123 | 123
  25 |  77 | dddddddd                         | abc | 123 | 123
  26 |  88 | dddddddd                         | abc | 123 | 123
  27 |  99 | dddddddd                         | abc | 123 | 123
  28 |     | dddddddd                         | abc | 333 | 123
  29 | 222 | dddddddd                         | abc | 123 | 123
  30 | 333 | dddddddd                         | abc | 123 | 123
  31 | 334 | dddddddd                         | abc | 123 | 123
  32 | 335 | dddddddd                         | abc | 123 | 123
  33 | 336 | dddddddd                         | abc | 123 | 123
  34 | 337 | dddddddd                         | abc | 123 | 123
  35 | 338 | dddddddd                         | abc | 123 | 123
  36 | 339 | dddddddd                         | abc | 123 | 123
  37 | 340 | dddddddd                         | abc | 123 | 123
  38 | 341 | dddddddd                         | abc | 123 | 123
  39 | 342 | dddddddd                         | abc | 123 | 123
  40 | 343 | dddddddd                         | abc | 123 | 123
  41 | 344 | dddddddd                         | abc | 123 | 123
  42 | 345 | dddddddd                         | abc | 123 | 123
 999 |     | dddddddd                         | abc | 123 | 123
(43 rows)

update scm3.t11 set ff=ff+1 where bb > 10;
UPDATE 41
select*from scm3.t11 order by aa;
 aa  | bb  |                dd                |  e  | ff  |  g  
-----+-----+----------------------------------+-----+-----+-----
   1 |  11 | dddddddd                         | abc | 124 | 123
   2 |  22 | dddddddd                         | abc | 124 | 123
   3 |  33 | dddddddd                         | abc | 124 | 123
   4 |  11 | dddddddd                         | abc | 124 | 123
   5 |  22 | dddddddd                         | abc | 124 | 123
   6 |  33 | dddddddd                         | abc | 124 | 123
   7 |  11 | dddddddd                         | abc | 124 | 123
   8 |  22 | dddddddd                         | abc | 124 | 123
   9 |  33 | dddddddd                         | abc | 124 | 123
  10 |  11 | dddddddd                         | abc | 124 | 123
  11 |  22 | dddddddd                         | abc | 124 | 123
  12 |  33 | dddddddd                         | abc | 124 | 123
  13 |  11 | dddddddd                         | abc | 124 | 123
  14 |  22 | dddddddd                         | abc | 124 | 123
  15 |  33 | dddddddd                         | abc | 124 | 123
  16 |  44 | dddddddd                         | abc | 124 | 123
  17 |  44 | dddddddd                         | abc | 124 | 123
  18 |  55 | dddddddd                         | abc | 124 | 123
  19 |  66 | dddddddd                         | abc | 124 | 123
  20 |  66 | dddddddd                         | abc | 124 | 123
  21 |  66 | dddddddd                         | abc | 124 | 123
  22 |  77 | dddddddd                         | abc | 124 | 123
  23 |  77 | dddddddd                         | abc | 124 | 123
  24 |  77 | dddddddd                         | abc | 124 | 123
  25 |  77 | dddddddd                         | abc | 124 | 123
  26 |  88 | dddddddd                         | abc | 124 | 123
  27 |  99 | dddddddd                         | abc | 124 | 123
  28 |     | dddddddd                         | abc | 333 | 123
  29 | 222 | dddddddd                         | abc | 124 | 123
  30 | 333 | dddddddd                         | abc | 124 | 123
  31 | 334 | dddddddd                         | abc | 124 | 123
  32 | 335 | dddddddd                         | abc | 124 | 123
  33 | 336 | dddddddd                         | abc | 124 | 123
  34 | 337 | dddddddd                         | abc | 124 | 123
  35 | 338 | dddddddd                         | abc | 124 | 123
  36 | 339 | dddddddd                         | abc | 124 | 123
  37 | 340 | dddddddd                         | abc | 124 | 123
  38 | 341 | dddddddd                         | abc | 124 | 123
  39 | 342 | dddddddd                         | abc | 124 | 123
  40 | 343 | dddddddd                         | abc | 124 | 123
  41 | 344 | dddddddd                         | abc | 124 | 123
  42 | 345 | dddddddd                         | abc | 124 | 123
 999 |     | dddddddd                         | abc | 123 | 123
(43 rows)

delete from scm3.t11 where bb < 10;
DELETE 0
select*from scm3.t11 order by aa;
 aa  | bb  |                dd                |  e  | ff  |  g  
-----+-----+----------------------------------+-----+-----+-----
   1 |  11 | dddddddd                         | abc | 124 | 123
   2 |  22 | dddddddd                         | abc | 124 | 123
   3 |  33 | dddddddd                         | abc | 124 | 123
   4 |  11 | dddddddd                         | abc | 124 | 123
   5 |  22 | dddddddd                         | abc | 124 | 123
   6 |  33 | dddddddd                         | abc | 124 | 123
   7 |  11 | dddddddd                         | abc | 124 | 123
   8 |  22 | dddddddd                         | abc | 124 | 123
   9 |  33 | dddddddd                         | abc | 124 | 123
  10 |  11 | dddddddd                         | abc | 124 | 123
  11 |  22 | dddddddd                         | abc | 124 | 123
  12 |  33 | dddddddd                         | abc | 124 | 123
  13 |  11 | dddddddd                         | abc | 124 | 123
  14 |  22 | dddddddd                         | abc | 124 | 123
  15 |  33 | dddddddd                         | abc | 124 | 123
  16 |  44 | dddddddd                         | abc | 124 | 123
  17 |  44 | dddddddd                         | abc | 124 | 123
  18 |  55 | dddddddd                         | abc | 124 | 123
  19 |  66 | dddddddd                         | abc | 124 | 123
  20 |  66 | dddddddd                         | abc | 124 | 123
  21 |  66 | dddddddd                         | abc | 124 | 123
  22 |  77 | dddddddd                         | abc | 124 | 123
  23 |  77 | dddddddd                         | abc | 124 | 123
  24 |  77 | dddddddd                         | abc | 124 | 123
  25 |  77 | dddddddd                         | abc | 124 | 123
  26 |  88 | dddddddd                         | abc | 124 | 123
  27 |  99 | dddddddd                         | abc | 124 | 123
  28 |     | dddddddd                         | abc | 333 | 123
  29 | 222 | dddddddd                         | abc | 124 | 123
  30 | 333 | dddddddd                         | abc | 124 | 123
  31 | 334 | dddddddd                         | abc | 124 | 123
  32 | 335 | dddddddd                         | abc | 124 | 123
  33 | 336 | dddddddd                         | abc | 124 | 123
  34 | 337 | dddddddd                         | abc | 124 | 123
  35 | 338 | dddddddd                         | abc | 124 | 123
  36 | 339 | dddddddd                         | abc | 124 | 123
  37 | 340 | dddddddd                         | abc | 124 | 123
  38 | 341 | dddddddd                         | abc | 124 | 123
  39 | 342 | dddddddd                         | abc | 124 | 123
  40 | 343 | dddddddd                         | abc | 124 | 123
  41 | 344 | dddddddd                         | abc | 124 | 123
  42 | 345 | dddddddd                         | abc | 124 | 123
 999 |     | dddddddd                         | abc | 123 | 123
(43 rows)

create table t11 (like scm3.t11 including all);
CREATE TABLE
select*from t11;
 aa | bb | dd | e | ff | g 
----+----+----+---+----+---
(0 rows)

insert into t11(bb) values(333),(334),(335),(336),(337),(338),(339),(340),(341),(342),(343),(344),(345);
INSERT 0 13
select*from t11;
 aa | bb  |                dd                |  e  | ff  |  g  
----+-----+----------------------------------+-----+-----+-----
 43 | 333 | dddddddd                         | abc | 123 | 123
 44 | 334 | dddddddd                         | abc | 123 | 123
 45 | 335 | dddddddd                         | abc | 123 | 123
 46 | 336 | dddddddd                         | abc | 123 | 123
 47 | 337 | dddddddd                         | abc | 123 | 123
 48 | 338 | dddddddd                         | abc | 123 | 123
 49 | 339 | dddddddd                         | abc | 123 | 123
 50 | 340 | dddddddd                         | abc | 123 | 123
 51 | 341 | dddddddd                         | abc | 123 | 123
 52 | 342 | dddddddd                         | abc | 123 | 123
 53 | 343 | dddddddd                         | abc | 123 | 123
 54 | 344 | dddddddd                         | abc | 123 | 123
 55 | 345 | dddddddd                         | abc | 123 | 123
(13 rows)

update t11 set ff=ff+1 where bb > 10;
UPDATE 13
select*from t11;
 aa | bb  |                dd                |  e  | ff  |  g  
----+-----+----------------------------------+-----+-----+-----
 43 | 333 | dddddddd                         | abc | 124 | 123
 44 | 334 | dddddddd                         | abc | 124 | 123
 45 | 335 | dddddddd                         | abc | 124 | 123
 46 | 336 | dddddddd                         | abc | 124 | 123
 47 | 337 | dddddddd                         | abc | 124 | 123
 48 | 338 | dddddddd                         | abc | 124 | 123
 49 | 339 | dddddddd                         | abc | 124 | 123
 50 | 340 | dddddddd                         | abc | 124 | 123
 51 | 341 | dddddddd                         | abc | 124 | 123
 52 | 342 | dddddddd                         | abc | 124 | 123
 53 | 343 | dddddddd                         | abc | 124 | 123
 54 | 344 | dddddddd                         | abc | 124 | 123
 55 | 345 | dddddddd                         | abc | 124 | 123
(13 rows)

delete from t11 where bb < 10;
DELETE 0
select*from t11;
 aa | bb  |                dd                |  e  | ff  |  g  
----+-----+----------------------------------+-----+-----+-----
 43 | 333 | dddddddd                         | abc | 124 | 123
 44 | 334 | dddddddd                         | abc | 124 | 123
 45 | 335 | dddddddd                         | abc | 124 | 123
 46 | 336 | dddddddd                         | abc | 124 | 123
 47 | 337 | dddddddd                         | abc | 124 | 123
 48 | 338 | dddddddd                         | abc | 124 | 123
 49 | 339 | dddddddd                         | abc | 124 | 123
 50 | 340 | dddddddd                         | abc | 124 | 123
 51 | 341 | dddddddd                         | abc | 124 | 123
 52 | 342 | dddddddd                         | abc | 124 | 123
 53 | 343 | dddddddd                         | abc | 124 | 123
 54 | 344 | dddddddd                         | abc | 124 | 123
 55 | 345 | dddddddd                         | abc | 124 | 123
(13 rows)

create table t30(a serial , b int unique not null default 3, primary key(a,b)) partition by range(b);
CREATE TABLE
create table t301 partition of t30 for values from (0) to (10000);
CREATE TABLE
create table t302 partition of t30 for values from (10000) to (20000);
CREATE TABLE
create table t303 partition of t30 for values from (20000) to (30000);
CREATE TABLE
create table t304 partition of t30 for values from (30000) to (40000);
CREATE TABLE
-- it's impossible to require c to be unique because that would require partition keys.
alter table t30 add column c serial;
psql:sql/alter_table3.sql:155: WARNING:  Sequence cannot be used until transaction commits
HINT:  If you are adding a serial column, make sure the original table is empty, as the new column will not be initialized by the sequence
psql:sql/alter_table3.sql:155: WARNING:  Sequence cannot be used until transaction commits
HINT:  If you are adding a serial column, make sure the original table is empty, as the new column will not be initialized by the sequence
psql:sql/alter_table3.sql:155: WARNING:  Sequence cannot be used until transaction commits
HINT:  If you are adding a serial column, make sure the original table is empty, as the new column will not be initialized by the sequence
psql:sql/alter_table3.sql:155: WARNING:  Sequence cannot be used until transaction commits
HINT:  If you are adding a serial column, make sure the original table is empty, as the new column will not be initialized by the sequence
ALTER TABLE
insert into t30 (b) values(11),(12),(13),(14),(15);
INSERT 0 5
insert into t30 (b) values(14000),(14001),(14002),(14003),(14004);
INSERT 0 5
insert into t30 (b) values(25000),(25001),(25002),(25003),(25004);
INSERT 0 5
insert into t30 (b) values(36000),(36001),(36002),(36003),(36004);
INSERT 0 5
select*from t30;
 a  |   b   | c  
----+-------+----
  1 |    11 |  1
  2 |    12 |  2
  3 |    13 |  3
  4 |    14 |  4
  5 |    15 |  5
  6 | 14000 |  6
  7 | 14001 |  7
  8 | 14002 |  8
  9 | 14003 |  9
 10 | 14004 | 10
 11 | 25000 | 11
 12 | 25001 | 12
 13 | 25002 | 13
 14 | 25003 | 14
 15 | 25004 | 15
 16 | 36000 | 16
 17 | 36001 | 17
 18 | 36002 | 18
 19 | 36003 | 19
 20 | 36004 | 20
(20 rows)

-- when there are rows, can't demand uniqueness for the target column even the
-- column is nullable because mysql will add 0 as 'default default value' when
-- no default value specified.
--alter table t30 add column d serial;
select*from t30;
 a  |   b   | c  
----+-------+----
  1 |    11 |  1
  2 |    12 |  2
  3 |    13 |  3
  4 |    14 |  4
  5 |    15 |  5
  6 | 14000 |  6
  7 | 14001 |  7
  8 | 14002 |  8
  9 | 14003 |  9
 10 | 14004 | 10
 11 | 25000 | 11
 12 | 25001 | 12
 13 | 25002 | 13
 14 | 25003 | 14
 15 | 25004 | 15
 16 | 36000 | 16
 17 | 36001 | 17
 18 | 36002 | 18
 19 | 36003 | 19
 20 | 36004 | 20
(20 rows)

alter table t30 rename a to aa;
ALTER TABLE
alter table t30 rename b to bb;
ALTER TABLE
alter table t30 rename c to cc;
ALTER TABLE
alter table t30 add column e int;
ALTER TABLE
alter table t30 add column f int;
ALTER TABLE
alter table t30 alter column bb drop default, alter column bb add generated by default as identity(start 100);
ALTER TABLE
--\d+ t30;
insert into t30(e) values(1111),(1111),(1111),(1111);
INSERT 0 4
update t30 set f=2222;
UPDATE 24
select*from t30;
 aa |  bb   | cc |  e   |  f   
----+-------+----+------+------
  1 |    11 |  1 |      | 2222
  2 |    12 |  2 |      | 2222
  3 |    13 |  3 |      | 2222
  4 |    14 |  4 |      | 2222
  5 |    15 |  5 |      | 2222
 21 |   100 | 21 | 1111 | 2222
 22 |   101 | 22 | 1111 | 2222
 23 |   102 | 23 | 1111 | 2222
 24 |   103 | 24 | 1111 | 2222
  6 | 14000 |  6 |      | 2222
  7 | 14001 |  7 |      | 2222
  8 | 14002 |  8 |      | 2222
  9 | 14003 |  9 |      | 2222
 10 | 14004 | 10 |      | 2222
 11 | 25000 | 11 |      | 2222
 12 | 25001 | 12 |      | 2222
 13 | 25002 | 13 |      | 2222
 14 | 25003 | 14 |      | 2222
 15 | 25004 | 15 |      | 2222
 16 | 36000 | 16 |      | 2222
 17 | 36001 | 17 |      | 2222
 18 | 36002 | 18 |      | 2222
 19 | 36003 | 19 |      | 2222
 20 | 36004 | 20 |      | 2222
(24 rows)

alter table t30 alter column e add generated by default as identity, alter column f set not null, alter column f add generated by default as identity, alter bb drop identity;
psql:sql/alter_table3.sql:179: ERROR:  column "e" of relation "t30" must be declared NOT NULL before identity can be added
--\d+ t30;
insert into t30(bb) values(200),(201),(202),(203);
INSERT 0 4
select*from t30;
 aa |  bb   | cc |  e   |  f   
----+-------+----+------+------
  1 |    11 |  1 |      | 2222
  2 |    12 |  2 |      | 2222
  3 |    13 |  3 |      | 2222
  4 |    14 |  4 |      | 2222
  5 |    15 |  5 |      | 2222
 21 |   100 | 21 | 1111 | 2222
 22 |   101 | 22 | 1111 | 2222
 23 |   102 | 23 | 1111 | 2222
 24 |   103 | 24 | 1111 | 2222
 25 |   200 | 25 |      |     
 26 |   201 | 26 |      |     
 27 |   202 | 27 |      |     
 28 |   203 | 28 |      |     
  6 | 14000 |  6 |      | 2222
  7 | 14001 |  7 |      | 2222
  8 | 14002 |  8 |      | 2222
  9 | 14003 |  9 |      | 2222
 10 | 14004 | 10 |      | 2222
 11 | 25000 | 11 |      | 2222
 12 | 25001 | 12 |      | 2222
 13 | 25002 | 13 |      | 2222
 14 | 25003 | 14 |      | 2222
 15 | 25004 | 15 |      | 2222
 16 | 36000 | 16 |      | 2222
 17 | 36001 | 17 |      | 2222
 18 | 36002 | 18 |      | 2222
 19 | 36003 | 19 |      | 2222
 20 | 36004 | 20 |      | 2222
(28 rows)

alter table t30 alter column e set start 1000;
psql:sql/alter_table3.sql:183: ERROR:  column "e" of relation "t30" is not an identity column
create table t31 (like t30 including all) partition by hash(bb);
CREATE TABLE
create table t310 partition of t31 for values with (modulus 4, remainder 0);
CREATE TABLE
create table t311 partition of t31 for values with (modulus 4, remainder 1);
CREATE TABLE
create table t312 partition of t31 for values with (modulus 4, remainder 2);
CREATE TABLE
create table t313 partition of t31 for values with (modulus 4, remainder 3);
CREATE TABLE
--\d+ t31;
insert into t31 (bb) values(1),(2),(3),(4),(5),(10004),(10005),(10006),(20007),(20008),(30009);
INSERT 0 11
select*from t31;
 aa |  bb   | cc | e | f 
----+-------+----+---+---
 29 |     1 | 29 |   |  
 31 |     3 | 31 |   |  
 33 |     5 | 33 |   |  
 39 | 30009 | 39 |   |  
 30 |     2 | 30 |   |  
 35 | 10005 | 35 |   |  
 38 | 20008 | 38 |   |  
 32 |     4 | 32 |   |  
 34 | 10004 | 34 |   |  
 36 | 10006 | 36 |   |  
 37 | 20007 | 37 |   |  
(11 rows)

--update t31 set bb=bb-1 where bb < 30000;
--select*from t31;
delete from t31 where cc > 18000;
DELETE 0
select*from t31;
 aa |  bb   | cc | e | f 
----+-------+----+---+---
 29 |     1 | 29 |   |  
 31 |     3 | 31 |   |  
 33 |     5 | 33 |   |  
 39 | 30009 | 39 |   |  
 30 |     2 | 30 |   |  
 35 | 10005 | 35 |   |  
 38 | 20008 | 38 |   |  
 32 |     4 | 32 |   |  
 34 | 10004 | 34 |   |  
 36 | 10006 | 36 |   |  
 37 | 20007 | 37 |   |  
(11 rows)

drop table t11;
DROP TABLE
drop table t31;
DROP TABLE
drop table t30;
DROP TABLE
drop table scm3.t11;
DROP TABLE
drop schema scm3 cascade;
DROP SCHEMA
